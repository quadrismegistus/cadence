Timer unit: 1e-06 s

Total time: 0.012526 s
File: ../prosodic2/constraints/constraints.py
Function: no_weak_peaks at line 13

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    13                                           def no_weak_peaks(df_mcombo):
    14        26      12526.0    481.8    100.0      return np.multiply(df_mcombo.is_w, df_mcombo.is_peak)

Total time: 0.043869 s
File: ../prosodic2/constraints/constraints.py
Function: apply_constraints at line 47

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    47                                           def apply_constraints(df_mcombo,constraints=DEFAULT_CONSTRAINTS):
    48        26        298.0     11.5      0.7      dfc=pd.DataFrame(df_mcombo)
    49                                               # dfc['parse']=df_mcombo['parse']
    50        26          7.0      0.3      0.0      total=None
    51        52         62.0      1.2      0.1      for cname,cfunc in constraints.items():
    52        26      12587.0    484.1     28.7          cvals=cfunc(df_mcombo)
    53        26       3791.0    145.8      8.6          cvals=pd.to_numeric(cvals,errors='coerce')
    54        26         19.0      0.7      0.0          if total is None: total=cvals
    55                                                   else: total+=cvals
    56        26      13661.0    525.4     31.1          dfc['*'+cname]=cvals
    57        26      13419.0    516.1     30.6      dfc['*total']=total
    58        26         25.0      1.0      0.1      return dfc

Total time: 0.000743 s
File: ../prosodic2/langs/english.py
Function: parse at line 36

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    36                                           def parse(line,incl_alt=True,**y):
    37                                           	return [
    38         2          2.0      1.0      0.3  		{
    39                                           			'word_i':word_i,
    40                                           			**word_dx
    41         2        741.0    370.5     99.7  		} for word_i,word in enumerate(tokenize(line))
    42                                           		for word_dx in get(word,incl_alt=incl_alt)
    43                                           	]

Total time: 0.017188 s
File: ../prosodic2/langs/langs.py
Function: line2df at line 20

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    20                                           def line2df(line_txt,lang=DEFAULT_LANG,sby=['word_i','word_ipa_i','syll_i'],incl_alt=INCL_ALT,**y):
    21         2          3.0      1.5      0.0      func = CODE2LANG.get(lang, CODE2LANG[DEFAULT_LANG] )
    22         2        756.0    378.0      4.4      ld=func(line_txt,incl_alt=incl_alt,**y)
    23         2          2.0      1.0      0.0      if not ld: return pd.DataFrame()
    24         2       3214.0   1607.0     18.7      df=pd.DataFrame(ld)
    25                                               # annotate proms
    26                                               # df=anno_proms(df)
    27         2          4.0      2.0      0.0      try:
    28         2      13209.0   6604.5     76.9          return df.sort_values(sby)[sby + [col for col in df.columns if col not in set(sby)]]
    29                                               except KeyError:
    30                                                   return df

Total time: 0.000201 s
File: ../prosodic2/langs/langs.py
Function: getstress at line 61

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    61                                           def getstress(sylipa):
    62       106         98.0      0.9     48.8      if not sylipa.strip(): return ' '
    63       105         69.0      0.7     34.3      if sylipa.startswith("'"): return 1.0#""
    64        59         25.0      0.4     12.4      elif sylipa.startswith("`"): return 0.5
    65        59          9.0      0.2      4.5      return 0.0

Total time: 0.000482 s
File: ../prosodic2/langs/langs.py
Function: getstress_str at line 67

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    67                                           def getstress_str(sylipa):
    68        86        422.0      4.9     87.6      x=getstress(sylipa)
    69        86         36.0      0.4      7.5      if x==1.0: return 'P'
    70        48         12.0      0.2      2.5      if x==0.5: return 'S'
    71        48         12.0      0.2      2.5      return 'U'

Total time: 0.002367 s
File: ../prosodic2/langs/langs.py
Function: getstrength at line 81

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    81                                           def getstrength(df_word):
    82        13       1979.0    152.2     83.6      stresses=dict(zip(df_word.syll_i,df_word.prom_stress))
    83        13         12.0      0.9      0.5      strengths={}
    84        28         43.0      1.5      1.8      for si,(syll_i,syl) in enumerate(sorted(stresses.items())):
    85        15         13.0      0.9      0.5          prv=stresses.get(syll_i-1)
    86        15         10.0      0.7      0.4          nxt=stresses.get(syll_i+1)
    87        15         10.0      0.7      0.4          if nxt!=None and prv!=None:
    88         1          1.0      1.0      0.0              if syl>nxt or syl>prv:
    89                                                           strength=1.0
    90         1          0.0      0.0      0.0              elif syl<nxt or syl<prv:
    91                                                           strength=0.0
    92                                                       else:
    93         1          0.0      0.0      0.0                  strength=np.nan
    94        14          8.0      0.6      0.3          elif prv==None and nxt!=None:
    95         1          0.0      0.0      0.0              if syl>nxt:
    96                                                           strength=1.0
    97         1          1.0      1.0      0.0              elif syl<nxt:
    98                                                           strength=0.0
    99                                                       else:
   100         1          1.0      1.0      0.0                  strength=np.nan
   101        13          9.0      0.7      0.4          elif prv!=None and nxt==None:
   102         1          1.0      1.0      0.0              if syl>prv:
   103                                                           strength=1.0
   104         1          1.0      1.0      0.0              elif syl<prv:
   105                                                           strength=0.0
   106                                                       else:
   107         1          1.0      1.0      0.0                  strength=np.nan
   108        12          7.0      0.6      0.3          elif prv==None and nxt==None:
   109        12          8.0      0.7      0.3              strength=np.nan
   110                                                   else:
   111                                                       raise Exception("How? -getstrength()")
   112                                                   #strengths.append(strength)
   113        15          9.0      0.6      0.4          strengths[syll_i]=strength
   114                                               return [
   115        13          9.0      0.7      0.4          strengths.get(syll_i)
   116        13        244.0     18.8     10.3          for syll_i in df_word.syll_i
   117                                               ]

Total time: 0.610041 s
File: ../prosodic2/parsers/metrics.py
Function: parse_lines at line 3

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
     3                                           def parse_lines(df_phon,num_proc=1,keep_best=KEEP_BEST,**y):
     4         1          1.0      1.0      0.0      yield from pmap_groups(
     5         1          1.0      1.0      0.0          parse_line,
     6         1        440.0    440.0      0.1          df_phon.groupby(['stanza_i','line_i']),
     7         1          0.0      0.0      0.0          num_proc=num_proc,
     8         1          1.0      1.0      0.0          kwargs=dict(keep_best=keep_best,num_proc=1),
     9         1          0.0      0.0      0.0          progress=True,
    10         1          1.0      1.0      0.0          desc='Parsing lines',
    11         1     609597.0 609597.0     99.9          **y
    12                                               )

Total time: 3.82052 s
File: ../prosodic2/parsers/metrics.py
Function: parse_line at line 14

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    14                                           def parse_line(line_df,num_proc=1,by_line=True,keep_best=KEEP_BEST,addback_str=False,**y):
    15         2     203191.0 101595.5      5.3      df_combos = line2combos(line_df)
    16         2          2.0      1.0      0.0      out = pmap_groups(
    17         2          1.0      0.5      0.0          parse_combo,
    18         2        908.0    454.0      0.0          df_combos.groupby(['stanza_i','line_i','line_combo_i']),
    19         2          2.0      1.0      0.0          num_proc=num_proc,
    20         2          0.0      0.0      0.0          progress=False,#num_proc==1,
    21         2          0.0      0.0      0.0          desc='Parsing all combinations for line',
    22         2          4.0      2.0      0.0          **y
    23                                               )
    24         2    3616414.0 1808207.0     94.7      yield parses_by_line(pd.concat(out))# if by_line else out

Total time: 0.011694 s
File: ../prosodic2/parsers/metrics.py
Function: parses_by_line at line 27

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    27                                           def parses_by_line(df_parses, keep_best=1):
    28                                               pcols=[
    29         1          1.0      1.0      0.0          'stanza_i',
    30         1          1.0      1.0      0.0          'line_i',
    31         1          1.0      1.0      0.0          'meter_parse',   
    32         1          0.0      0.0      0.0          'meter_parse_repr',
    33         1          0.0      0.0      0.0          'stress_parse_ipa',
    34                                                   # 'stress_parse_repr',
    35                                               ]
    36         1         14.0     14.0      0.1      ccols = [c for c in df_parses.columns if c.startswith('*')]
    37         1       9480.0   9480.0     81.1      dfg=df_parses.groupby(pcols).sum()[ccols].reset_index()
    38                                               
    39         1          1.0      1.0      0.0      if keep_best:
    40         1       2195.0   2195.0     18.8          dfg=dfg.sort_values('*total').groupby(['stanza_i','line_i']).head(keep_best)
    41                                           
    42         1          1.0      1.0      0.0      return dfg

Total time: 0.044067 s
File: ../prosodic2/parsers/metrics.py
Function: do_parse_combo at line 47

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    47                                           def do_parse_combo(df_mcombo):
    48                                               # apply constraints
    49        26      44061.0   1694.7    100.0      df_mcombo_parsed = apply_constraints(df_mcombo)
    50        26          6.0      0.2      0.0      yield df_mcombo_parsed

Total time: 0.405391 s
File: ../prosodic2/parsers/metrics.py
Function: mpos_windows at line 52

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    52                                           def mpos_windows(df_all_combos, windowlen=3):
    53         2          2.0      1.0      0.0      windows_done=set()
    54         2          1.0      0.5      0.0      window=[None,None,None]
    55      1938     253400.0    130.8     62.5      for i,row in df_all_combos.iterrows():
    56      1936       3729.0      1.9      0.9          window=window[1:] + [row]
    57      1936        814.0      0.4      0.2          window_key=tuple(
    58      1936        754.0      0.4      0.2              row.parse if row is not None else None
    59      1936      87113.0     45.0     21.5              for row in window
    60                                                   )
    61      1936       1289.0      0.7      0.3          if window_key in windows_done: continue
    62        20         18.0      0.9      0.0          windows_done|={window_key}
    63                                           
    64        20      58271.0   2913.6     14.4          yield pd.DataFrame(window)

Total time: 3.49471 s
File: ../prosodic2/parsers/metrics.py
Function: parse_combo at line 66

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    66                                           def parse_combo(df_combo):
    67         2       4101.0   2050.5      0.1      wordsyllsmeter_combos = _all_possible_metrical_combos(df_combo)
    68         2       4330.0   2165.0      0.1      dfwsc = df_combo.set_index(['word_i','syll_i'])
    69         2       1055.0    527.5      0.0      dfall=pd.DataFrame()
    70                                               # objs=[]
    71       206        415.0      2.0      0.0      for wi,wsc in enumerate(wordsyllsmeter_combos):#,desc='Parsing line combos',position=1)):
    72       204       1251.0      6.1      0.0          ws2mtr=dict(([((w,s),c) for w,s,c in wsc]))
    73       204    1176953.0   5769.4     33.7          df_mcombo = pd.DataFrame(dfwsc.loc[ws2mtr.keys()].reset_index().sort_values(['word_i','syll_i']))
    74       204     144165.0    706.7      4.1          df_mcombo['parse']=[ws2mtr.get((w,s)) for w,s in zip(df_mcombo.word_i,df_combo.syll_i)]
    75       204     111391.0    546.0      3.2          df_mcombo['meter_parse_i']=wi
    76       204     122801.0    602.0      3.5          df_mcombo['meter_parse']=''.join(df_mcombo['parse'])
    77       204     217531.0   1066.3      6.2          df_mcombo['is_w']=(df_mcombo['parse']=='w').apply(np.int32)
    78       204     210757.0   1033.1      6.0          df_mcombo['is_s']=(df_mcombo['parse']=='s').apply(np.int32)
    79       204     108580.0    532.3      3.1          df_mcombo['meter_parse_repr']=''
    80                                                   # df_mcombo['meter_parse_repr']='|'.join(
    81                                                   #     '.'.join([
    82                                                   #         tok.upper() if parse=='s' else tok.lower()
    83                                                   #         for tok,parse in zip(df_word.syll_str, df_word.parse)
    84                                                   #     ])
    85                                                   #     for i,df_word in sorted(df_mcombo.groupby(['word_i','word_ipa_i']))
    86                                                   # )
    87       204     975287.0   4780.8     27.9          dfall=dfall.append(df_mcombo)
    88                                               
    89                                               
    90                                               ### make unique
    91         2     410403.0 205201.5     11.7      windows = list(mpos_windows(dfall))
    92         2        137.0     68.5      0.0      print(len(windows))
    93         2          2.0      1.0      0.0      yield from pmap_groups(
    94         2          1.0      0.5      0.0          do_parse_combo,
    95         2        409.0    204.5      0.0          dfall.groupby('meter_parse_i'),
    96         2          1.0      0.5      0.0          num_proc=1,
    97         2          1.0      0.5      0.0          progress=False,
    98         2       5141.0   2570.5      0.1          use_cache=False
    99                                               )

Total time: 0.202788 s
File: ../prosodic2/parsers/metrics.py
Function: line2combos at line 103

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
   103                                           def line2combos(line_df,**y):
   104                                               word_rows = [
   105         2          3.0      1.5      0.0          set(list(zip(word_df.word_i, word_df.word_ipa_i, word_df.word_ipa)))                
   106                                                   # set(list(zip(word_df.word_i, word_df.word_ipa_i, word_df.word_ipa)))                
   107         2       7316.0   3658.0      3.6          for word_i,word_df in sorted(line_df.groupby('word_i'))
   108                                               ]
   109                                           
   110                                               # divide at blank points
   111         2          4.0      2.0      0.0      word_rows_div=[]
   112         2          2.0      1.0      0.0      word_row_div = []
   113        17         20.0      1.2      0.0      for wordforms in word_rows:
   114                                                   # split into phrases?
   115        15         25.0      1.7      0.0          if len(wordforms)==1 and not list(wordforms)[0][-1].strip():
   116         1          1.0      1.0      0.0              if len(word_row_div)>=MIN_WORDS_IN_PHRASE:
   117         1          1.0      1.0      0.0                  word_rows_div.append(word_row_div)
   118         1          1.0      1.0      0.0                  word_row_div=[]
   119                                                   else:
   120        14         16.0      1.1      0.0              word_row_div.append(wordforms)
   121         2          2.0      1.0      0.0      if word_row_div: word_rows_div.append(word_row_div)
   122                                           
   123         2         13.0      6.5      0.0      from pprint import pprint
   124                                               
   125                                               # gen combos
   126         2          3.0      1.5      0.0      all_combos = []
   127         4          5.0      1.2      0.0      for word_row_div in word_rows_div:
   128         2         77.0     38.5      0.0          combos = list(product(*word_row_div))
   129         2          4.0      2.0      0.0          all_combos.extend(combos)
   130                                               
   131                                               # loop
   132         2       1044.0    522.0      0.5      combo_dfs=pd.DataFrame()
   133         2       4237.0   2118.5      2.1      ldf=line_df.set_index(['word_i','word_ipa_i'])
   134        11         24.0      2.2      0.0      for combo_i,combo in enumerate(all_combos):
   135                                                   # print(combo)
   136         9      51698.0   5744.2     25.5          combo_df=pd.DataFrame(ldf.loc[[(cx[0],cx[1]) for cx in combo]].reset_index())
   137                                                   # display(combo_df)
   138         9       5007.0    556.3      2.5          combo_df['line_combo_i']=combo_i
   139         9         16.0      1.8      0.0          combo_df['stress_parse']=''.join(
   140         9         13.0      1.4      0.0              ''.join([getstress_str(sylipa) for sylipa in df_word.syll_ipa])
   141         9      35580.0   3953.3     17.5              for i,df_word in combo_df.groupby(['word_i','word_ipa_i'])
   142                                                   ).lower()
   143         9         15.0      1.7      0.0          combo_df['stress_parse_ipa']='|'.join(
   144         9         12.0      1.3      0.0              '.'.join(df_word.syll_ipa)
   145         9      35306.0   3922.9     17.4              for i,df_word in combo_df.groupby(['word_i','word_ipa_i'])
   146                                                   )#.lower()
   147         9         20.0      2.2      0.0          combo_df['stress_parse_repr']='|'.join(
   148         9         13.0      1.4      0.0              '.'.join([
   149                                                           tok.upper() if stress>0 else tok.lower()
   150                                                           for tok,stress in zip(df_word.syll_str, df_word.prom_stress)
   151                                                       ])
   152         9      39548.0   4394.2     19.5              for i,df_word in combo_df.groupby(['word_i','word_ipa_i'])
   153                                                   )
   154         9      22761.0   2529.0     11.2          combo_dfs=combo_dfs.append(combo_df)
   155                                                   # break
   156         2          1.0      0.5      0.0      return combo_dfs

Total time: 2.4e-05 s
File: ../prosodic2/parsers/phonology.py
Function: to_txt at line 4

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
     4                                           def to_txt(txt_or_fn):
     5                                               # load txt
     6         1          0.0      0.0      0.0      if not txt_or_fn: return
     7         1         23.0     23.0     95.8      if os.path.exists(txt_or_fn):
     8                                                   with open(txt_or_fn) as f:
     9                                                       txt=f.read()
    10                                               else:
    11         1          0.0      0.0      0.0          txt=txt_or_fn
    12         1          1.0      1.0      4.2      return txt

Total time: 3e-06 s
File: ../prosodic2/parsers/phonology.py
Function: to_stanzas at line 17

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    17                                           def to_stanzas(full_txt):
    18         1          3.0      3.0    100.0      return [st.strip() for st in full_txt.strip().split('\n\n') if st.strip()]

Total time: 2e-06 s
File: ../prosodic2/parsers/phonology.py
Function: to_lines at line 21

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    21                                           def to_lines(stanza_txt):
    22         1          2.0      2.0    100.0      return [l.strip() for l in stanza_txt.split('\n') if l.strip()]

Total time: 0.038838 s
File: ../prosodic2/parsers/phonology.py
Function: do_parse_phon at line 37

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    37                                           def do_parse_phon(obj):
    38         2          2.0      1.0      0.0      stanza_i,line_i,line_txt,lang_code,incl_alt,kwargs = obj
    39         2      17238.0   8619.0     44.4      df=line2df(line_txt,lang=lang_code,incl_alt=incl_alt,**kwargs)
    40         2         18.0      9.0      0.0      cols=list(df.columns)
    41         2       1662.0    831.0      4.3      df['stanza_i']=stanza_i
    42         2       1214.0    607.0      3.1      df['line_i']=line_i
    43         2          2.0      1.0      0.0      prefix=['stanza_i','line_i','word_i','word_ipa_i','syll_i']
    44         2      18699.0   9349.5     48.1      df=df[prefix + [c for c in cols if c not in set(prefix)]]
    45         2          3.0      1.5      0.0      return df

Total time: 0.061542 s
File: ../prosodic2/parsers/phonology.py
Function: parse_phon at line 47

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    47                                           def parse_phon(txt_or_fn,lang=DEFAULT_LANG,progress=True,incl_alt=INCL_ALT,num_proc=DEFAULT_NUM_PROC,**kwargs):
    48         1         27.0     27.0      0.0      full_txt=to_txt(txt_or_fn)
    49         1          0.0      0.0      0.0      if not full_txt: return
    50                                           
    51                                               #stanza_iter = to_stanzas(full_txt) if not progress else tqdm(to_stanzas(full_txt),desc='Tokenizing and syllabifying')
    52                                           
    53                                           
    54         1        693.0    693.0      1.1      df=pd.DataFrame()
    55         1          1.0      1.0      0.0      objs=[]
    56                                           
    57         2          8.0      4.0      0.0      for stanza_i,stanza_txt in enumerate(to_stanzas(full_txt)):
    58         3          5.0      1.7      0.0          for line_i,line_txt in enumerate(to_lines(stanza_txt)):
    59         2          2.0      1.0      0.0              objs+=[(stanza_i,line_i,line_txt,lang,incl_alt,kwargs)]
    60                                               
    61         1          1.0      1.0      0.0      df = pd.concat(
    62         1          0.0      0.0      0.0          pmap(
    63         1          0.0      0.0      0.0              do_parse_phon,
    64         1          0.0      0.0      0.0              objs,
    65         1          0.0      0.0      0.0              num_proc=num_proc,
    66         1          1.0      1.0      0.0              desc='Tokenizing and syllabifying',
    67         1      43504.0  43504.0     70.7              progress=progress
    68                                                   )
    69                                               )
    70                                           
    71                                               # assign proms
    72         1      17299.0  17299.0     28.1      assign_proms(df)
    73         1          1.0      1.0      0.0      return df

Total time: 0.017269 s
File: ../prosodic2/parsers/phonology.py
Function: assign_proms at line 76

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    76                                           def assign_proms(df):
    77                                               # set proms
    78         1       5457.0   5457.0     31.6      df['prom_stress']=pd.to_numeric(df['syll_ipa'].apply(getstress),errors='coerce')
    79                                               # # df['syll_weight']=[
    80                                               # #     weight
    81                                               # #     for i,df_syll in df.groupby(['word_i','word_ipa_i','syll_i'])
    82                                               # #     for weight in self.lang.getweight(df_syll)
    83                                               # # ]f
    84                                               df['prom_strength']=[
    85         1          2.0      2.0      0.0          x
    86         1       6016.0   6016.0     34.8          for i,df_word in df.groupby(['word_i','word_ipa_i'])
    87                                                   for x in getstrength(df_word)
    88                                               ]
    89                                               
    90         1       1723.0   1723.0     10.0      df['is_stressed']=(df['prom_stress']>0).apply(np.int32)
    91         1       1081.0   1081.0      6.3      df['is_unstressed']=1-df['is_stressed']
    92         1       1434.0   1434.0      8.3      df['is_peak']=(df['prom_strength']==True).apply(np.int32)
    93         1       1556.0   1556.0      9.0      df['is_trough']=(df['prom_strength']==False).apply(np.int32)

Total time: 3e-06 s
File: ../prosodic2/prosodic2.py
Function: __init__ at line 13

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    13                                               def __init__(self,txt_or_fn,lang='en'):
    14         1          1.0      1.0     33.3          self.txt_or_fn=txt_or_fn
    15         1          1.0      1.0     33.3          self.lang=lang
    16         1          1.0      1.0     33.3          self._df_phon={}
    17         1          0.0      0.0      0.0          self._df_metr={}

Total time: 0.061572 s
File: ../prosodic2/prosodic2.py
Function: parse_phon at line 19

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    19                                               def parse_phon(self,**y):
    20         1          5.0      5.0      0.0          key=hashstr(self.txt_or_fn,self.lang)[:12]
    21         1          1.0      1.0      0.0          if key not in self._df_phon:
    22         1      61565.0  61565.0    100.0              self._df_phon[key] = parse_phon(self.txt_or_fn, lang=self.lang,**y)
    23         1          1.0      1.0      0.0          return self._df_phon[key]

Total time: 3.89028 s
File: ../prosodic2/prosodic2.py
Function: parse_meter at line 29

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    29                                               def parse_meter(self,df=None,**y):
    30         1         16.0     16.0      0.0          key=hashstr(y)[:12]
    31         1          1.0      1.0      0.0          if not key in self._df_metr:
    32         1      61578.0  61578.0      1.6              if df is None: df = self.parse_phon(**y)
    33         1          1.0      1.0      0.0              l=[]
    34         2    3828679.0 1914339.5     98.4              for group in parse_lines(df,**y):
    35         1          0.0      0.0      0.0                  yield group
    36         1          1.0      1.0      0.0                  l+=[group]
    37                                                       self._df_metr[key] = l
    38                                                   # return self._df_metr[key]
    39                                                   else:
    40                                                       yield from l

Total time: 4.5e-05 s
File: ../prosodic2/tools/tools.py
Function: product at line 12

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    12                                           def product(*args):
    13        34          8.0      0.2     17.8  	if not args:
    14         4          1.0      0.2      2.2  		return iter(((),)) # yield tuple()
    15        30         13.0      0.4     28.9  	return (items + (item,)
    16        30         23.0      0.8     51.1  		for items in product(*args[:-1]) for item in args[-1])

Total time: 1.6e-05 s
File: ../prosodic2/tools/tools.py
Function: hashstr at line 19

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    19                                           def hashstr(*x):
    20         2          2.0      1.0     12.5  	import hashlib
    21         2         14.0      7.0     87.5  	return hashlib.sha224(str(x).encode('utf-8')).hexdigest()

Total time: 0.044481 s
File: ../prosodic2/tools/tools.py
Function: pmap_iter at line 27

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    27                                           def pmap_iter(func, objs, args=[], kwargs={}, num_proc=DEFAULT_NUM_PROC, use_threads=False, progress=True, desc=None, **y):
    28                                           	"""
    29                                           	Yields results of func(obj) for each obj in objs
    30                                           	Uses multiprocessing.Pool(num_proc) for parallelism.
    31                                           	If use_threads, use ThreadPool instead of Pool.
    32                                           	Results in any order.
    33                                           	"""
    34                                           	
    35                                           	# imports
    36         5         12.0      2.4      0.0  	import multiprocessing as mp
    37         5         32.0      6.4      0.1  	from tqdm import tqdm
    38                                           	
    39                                           	# check num proc
    40         5         68.0     13.6      0.2  	num_cpu = mp.cpu_count()
    41         5          4.0      0.8      0.0  	if num_proc>num_cpu: num_proc=num_cpu
    42                                           
    43                                           	# if parallel
    44         5          2.0      0.4      0.0  	if not desc: desc=f'Mapping {func.__name__}()'
    45         5         11.0      2.2      0.0  	if desc: desc=f'{desc} [x{num_proc}]'
    46         5          2.0      0.4      0.0  	if num_proc>1 and len(objs)>1:
    47                                           
    48                                           		# real objects
    49                                           		objects = [(func,obj,args,kwargs) for obj in objs]
    50                                           
    51                                           		# create pool
    52                                           		pool=mp.Pool(num_proc) if not use_threads else mp.pool.ThreadPool(num_proc)
    53                                           
    54                                           		# yield iter
    55                                           		iterr = pool.imap(pmap_do, objects)
    56                                           		
    57                                           		for res in tqdm(iterr,total=len(objects),desc=desc) if progress else iterr:
    58                                           			yield res
    59                                           
    60                                           		# Close the pool?
    61                                           		pool.close()
    62                                           		pool.join()
    63                                           	else:
    64                                           		# yield
    65        35       5428.0    155.1     12.2  		for obj in (tqdm(objs,desc=desc) if progress else objs):
    66        32      38922.0   1216.3     87.5  			yield func(obj,*args,**kwargs)

Total time: 0.042292 s
File: ../prosodic2/tools/tools.py
Function: pmap at line 68

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    68                                           def pmap(*x,**y):
    69                                           	"""
    70                                           	Non iterator version of pmap_iter
    71                                           	"""
    72                                           	# return as list
    73         1      42292.0  42292.0    100.0  	return list(pmap_iter(*x,**y))

Total time: 3.76766 s
File: ../prosodic2/tools/tools.py
Function: do_pmap_group at line 77

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    77                                           def do_pmap_group(obj,*args,**kwargs):
    78        30         36.0      1.2      0.0  	import pandas as pd
    79        30         61.0      2.0      0.0  	import types
    80        30         30.0      1.0      0.0  	func,group_df,group_key,group_name = obj
    81                                           	
    82        30         38.0      1.3      0.0  	if type(group_name) not in {list,tuple}:group_name=[group_name]
    83        30         13.0      0.4      0.0  	if type(group_df)==str: group_df=pd.read_pickle(group_df)
    84                                           
    85        30         25.0      0.8      0.0  	outgen=func(group_df,*args,**kwargs)
    86                                           	# outdf=pd.concat(out) if isinstance(out, types.GeneratorType) else out
    87        83    3753462.0  45222.4     99.6  	for outdf in outgen:
    88       159      13975.0     87.9      0.4  		for x,y in zip(group_key,group_name): outdf[x]=y
    89        53         19.0      0.4      0.0  		yield outdf

Total time: 3.76493 s
File: ../prosodic2/tools/tools.py
Function: pmap_groups at line 92

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    92                                           def pmap_groups(func,df_grouped,use_cache=True,num_proc=DEFAULT_NUM_PROC,iter=False,**attrs):
    93         5         19.0      3.8      0.0  	import os,tempfile,pandas as pd
    94         5         23.0      4.6      0.0  	from tqdm import tqdm
    95                                           	
    96                                           
    97                                           	# get index/groupby col name(s)
    98         5         20.0      4.0      0.0  	group_key=df_grouped.grouper.names
    99                                           	# if not using cache
   100                                           	# if not use_cache or attrs.get('num_proc',1)<2:
   101         5       7626.0   1525.2      0.2  	if not use_cache or len(df_grouped)<2 or num_proc<2:
   102                                           		objs=[
   103         5          9.0      1.8      0.0  			(func,group_df,group_key,group_name)
   104         5       9240.0   1848.0      0.2  			for group_name,group_df in df_grouped
   105                                           		]
   106                                           	else:
   107                                           		objs=[]
   108                                           		tmpdir=tempfile.mkdtemp()
   109                                           		# for i,(group_name,group_df) in enumerate(tqdm(list(df_grouped),desc='Preparing input')):
   110                                           		for i,(group_name,group_df) in enumerate(df_grouped):
   111                                           			tmp_path = os.path.join(tmpdir, str(i)+'.pkl')
   112                                           			# print([i,group_name,tmp_path,group_df])
   113                                           			group_df.to_pickle(tmp_path)
   114                                           			objs+=[(func,tmp_path,group_key,group_name)]
   115                                           
   116                                           	# desc?
   117         4         10.0      2.5      0.0  	if not attrs.get('desc'): attrs['desc']=f'Mapping {func.__name__}'
   118                                           
   119                                           	#iterfunc = pmap if not iter else pmap_iter
   120                                           	#return pd.concat(iterfunc) if not iter else
   121         4          4.0      1.0      0.0  	for group_iter in pmap_iter(
   122         4          2.0      0.5      0.0  		do_pmap_group,
   123         4          1.0      0.2      0.0  		objs,
   124         4          3.0      0.8      0.0  		num_proc=num_proc,
   125        32       2422.0     75.7      0.1  		**attrs
   126                                           	):
   127        30    3745550.0 124851.7     99.5  		yield from group_iter

Total time: 0.002633 s
File: /home/ryan/github/lltk/venv/lib/python3.7/site-packages/tqdm/std.py
Function: __init__ at line 826

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
   826                                               def __init__(self, iterable=None, desc=None, total=None, leave=True,
   827                                                            file=None, ncols=None, mininterval=0.1, maxinterval=10.0,
   828                                                            miniters=None, ascii=None, disable=False, unit='it',
   829                                                            unit_scale=False, dynamic_ncols=False, smoothing=0.3,
   830                                                            bar_format=None, initial=0, position=None, postfix=None,
   831                                                            unit_divisor=1000, write_bytes=None, lock_args=None,
   832                                                            nrows=None, colour=None,
   833                                                            gui=False, **kwargs):
   834                                                   """
   835                                                   Parameters
   836                                                   ----------
   837                                                   iterable  : iterable, optional
   838                                                       Iterable to decorate with a progressbar.
   839                                                       Leave blank to manually manage the updates.
   840                                                   desc  : str, optional
   841                                                       Prefix for the progressbar.
   842                                                   total  : int or float, optional
   843                                                       The number of expected iterations. If unspecified,
   844                                                       len(iterable) is used if possible. If float("inf") or as a last
   845                                                       resort, only basic progress statistics are displayed
   846                                                       (no ETA, no progressbar).
   847                                                       If `gui` is True and this parameter needs subsequent updating,
   848                                                       specify an initial arbitrary large positive number,
   849                                                       e.g. 9e9.
   850                                                   leave  : bool, optional
   851                                                       If [default: True], keeps all traces of the progressbar
   852                                                       upon termination of iteration.
   853                                                       If `None`, will leave only if `position` is `0`.
   854                                                   file  : `io.TextIOWrapper` or `io.StringIO`, optional
   855                                                       Specifies where to output the progress messages
   856                                                       (default: sys.stderr). Uses `file.write(str)` and `file.flush()`
   857                                                       methods.  For encoding, see `write_bytes`.
   858                                                   ncols  : int, optional
   859                                                       The width of the entire output message. If specified,
   860                                                       dynamically resizes the progressbar to stay within this bound.
   861                                                       If unspecified, attempts to use environment width. The
   862                                                       fallback is a meter width of 10 and no limit for the counter and
   863                                                       statistics. If 0, will not print any meter (only stats).
   864                                                   mininterval  : float, optional
   865                                                       Minimum progress display update interval [default: 0.1] seconds.
   866                                                   maxinterval  : float, optional
   867                                                       Maximum progress display update interval [default: 10] seconds.
   868                                                       Automatically adjusts `miniters` to correspond to `mininterval`
   869                                                       after long display update lag. Only works if `dynamic_miniters`
   870                                                       or monitor thread is enabled.
   871                                                   miniters  : int or float, optional
   872                                                       Minimum progress display update interval, in iterations.
   873                                                       If 0 and `dynamic_miniters`, will automatically adjust to equal
   874                                                       `mininterval` (more CPU efficient, good for tight loops).
   875                                                       If > 0, will skip display of specified number of iterations.
   876                                                       Tweak this and `mininterval` to get very efficient loops.
   877                                                       If your progress is erratic with both fast and slow iterations
   878                                                       (network, skipping items, etc) you should set miniters=1.
   879                                                   ascii  : bool or str, optional
   880                                                       If unspecified or False, use unicode (smooth blocks) to fill
   881                                                       the meter. The fallback is to use ASCII characters " 123456789#".
   882                                                   disable  : bool, optional
   883                                                       Whether to disable the entire progressbar wrapper
   884                                                       [default: False]. If set to None, disable on non-TTY.
   885                                                   unit  : str, optional
   886                                                       String that will be used to define the unit of each iteration
   887                                                       [default: it].
   888                                                   unit_scale  : bool or int or float, optional
   889                                                       If 1 or True, the number of iterations will be reduced/scaled
   890                                                       automatically and a metric prefix following the
   891                                                       International System of Units standard will be added
   892                                                       (kilo, mega, etc.) [default: False]. If any other non-zero
   893                                                       number, will scale `total` and `n`.
   894                                                   dynamic_ncols  : bool, optional
   895                                                       If set, constantly alters `ncols` and `nrows` to the
   896                                                       environment (allowing for window resizes) [default: False].
   897                                                   smoothing  : float, optional
   898                                                       Exponential moving average smoothing factor for speed estimates
   899                                                       (ignored in GUI mode). Ranges from 0 (average speed) to 1
   900                                                       (current/instantaneous speed) [default: 0.3].
   901                                                   bar_format  : str, optional
   902                                                       Specify a custom bar string formatting. May impact performance.
   903                                                       [default: '{l_bar}{bar}{r_bar}'], where
   904                                                       l_bar='{desc}: {percentage:3.0f}%|' and
   905                                                       r_bar='| {n_fmt}/{total_fmt} [{elapsed}<{remaining}, '
   906                                                         '{rate_fmt}{postfix}]'
   907                                                       Possible vars: l_bar, bar, r_bar, n, n_fmt, total, total_fmt,
   908                                                         percentage, elapsed, elapsed_s, ncols, nrows, desc, unit,
   909                                                         rate, rate_fmt, rate_noinv, rate_noinv_fmt,
   910                                                         rate_inv, rate_inv_fmt, postfix, unit_divisor,
   911                                                         remaining, remaining_s.
   912                                                       Note that a trailing ": " is automatically removed after {desc}
   913                                                       if the latter is empty.
   914                                                   initial  : int or float, optional
   915                                                       The initial counter value. Useful when restarting a progress
   916                                                       bar [default: 0]. If using float, consider specifying `{n:.3f}`
   917                                                       or similar in `bar_format`, or specifying `unit_scale`.
   918                                                   position  : int, optional
   919                                                       Specify the line offset to print this bar (starting from 0)
   920                                                       Automatic if unspecified.
   921                                                       Useful to manage multiple bars at once (eg, from threads).
   922                                                   postfix  : dict or *, optional
   923                                                       Specify additional stats to display at the end of the bar.
   924                                                       Calls `set_postfix(**postfix)` if possible (dict).
   925                                                   unit_divisor  : float, optional
   926                                                       [default: 1000], ignored unless `unit_scale` is True.
   927                                                   write_bytes  : bool, optional
   928                                                       If (default: None) and `file` is unspecified,
   929                                                       bytes will be written in Python 2. If `True` will also write
   930                                                       bytes. In all other cases will default to unicode.
   931                                                   lock_args  : tuple, optional
   932                                                       Passed to `refresh` for intermediate output
   933                                                       (initialisation, iterating, and updating).
   934                                                   nrows  : int, optional
   935                                                       The screen height. If specified, hides nested bars outside this
   936                                                       bound. If unspecified, attempts to use environment height.
   937                                                       The fallback is 20.
   938                                                   colour  : str, optional
   939                                                       Bar colour (e.g. 'green', '#00ff00').
   940                                                   gui  : bool, optional
   941                                                       WARNING: internal parameter - do not use.
   942                                                       Use tqdm.gui.tqdm(...) instead. If set, will attempt to use
   943                                                       matplotlib animations for a graphical output [default: False].
   944                                           
   945                                                   Returns
   946                                                   -------
   947                                                   out  : decorated iterator.
   948                                                   """
   949         2          3.0      1.5      0.1          if write_bytes is None:
   950         2          6.0      3.0      0.2              write_bytes = file is None and sys.version_info < (3,)
   951                                           
   952         2          2.0      1.0      0.1          if file is None:
   953         2          4.0      2.0      0.2              file = sys.stderr
   954                                           
   955         2          2.0      1.0      0.1          if write_bytes:
   956                                                       # Despite coercing unicode into bytes, py2 sys.std* streams
   957                                                       # should have bytes written to them.
   958                                                       file = SimpleTextIOWrapper(
   959                                                           file, encoding=getattr(file, 'encoding', None) or 'utf-8')
   960                                           
   961         2         43.0     21.5      1.6          file = DisableOnWriteError(file, tqdm_instance=self)
   962                                           
   963         2          3.0      1.5      0.1          if disable is None and hasattr(file, "isatty") and not file.isatty():
   964                                                       disable = True
   965                                           
   966         2          2.0      1.0      0.1          if total is None and iterable is not None:
   967         2          2.0      1.0      0.1              try:
   968         2          2.0      1.0      0.1                  total = len(iterable)
   969                                                       except (TypeError, AttributeError):
   970                                                           total = None
   971         2          7.0      3.5      0.3          if total == float("inf"):
   972                                                       # Infinite iterations, behave same as unknown
   973                                                       total = None
   974                                           
   975         2          2.0      1.0      0.1          if disable:
   976                                                       self.iterable = iterable
   977                                                       self.disable = disable
   978                                                       with self._lock:
   979                                                           self.pos = self._get_free_pos(self)
   980                                                           self._instances.remove(self)
   981                                                       self.n = initial
   982                                                       self.total = total
   983                                                       self.leave = leave
   984                                                       return
   985                                           
   986         2          3.0      1.5      0.1          if kwargs:
   987                                                       self.disable = True
   988                                                       with self._lock:
   989                                                           self.pos = self._get_free_pos(self)
   990                                                           self._instances.remove(self)
   991                                                       raise (
   992                                                           TqdmDeprecationWarning(
   993                                                               "`nested` is deprecated and automated.\n"
   994                                                               "Use `position` instead for manual control.\n",
   995                                                               fp_write=getattr(file, 'write', sys.stderr.write))
   996                                                           if "nested" in kwargs else
   997                                                           TqdmKeyError("Unknown argument(s): " + str(kwargs)))
   998                                           
   999                                                   # Preprocess the arguments
  1000         2          2.0      1.0      0.1          if ((ncols is None or nrows is None) and
  1001         2         12.0      6.0      0.5              (file in (sys.stderr, sys.stdout))) or \
  1002                                                           dynamic_ncols:  # pragma: no cover
  1003         2          2.0      1.0      0.1              if dynamic_ncols:
  1004                                                           dynamic_ncols = _screen_shape_wrapper()
  1005                                                           if dynamic_ncols:
  1006                                                               ncols, nrows = dynamic_ncols(file)
  1007                                                       else:
  1008         2          6.0      3.0      0.2                  _dynamic_ncols = _screen_shape_wrapper()
  1009         2          2.0      1.0      0.1                  if _dynamic_ncols:
  1010         2        116.0     58.0      4.4                      _ncols, _nrows = _dynamic_ncols(file)
  1011         2          2.0      1.0      0.1                      if ncols is None:
  1012         2          2.0      1.0      0.1                          ncols = _ncols
  1013         2          2.0      1.0      0.1                      if nrows is None:
  1014         2          2.0      1.0      0.1                          nrows = _nrows
  1015                                           
  1016         2          1.0      0.5      0.0          if miniters is None:
  1017         2          2.0      1.0      0.1              miniters = 0
  1018         2          2.0      1.0      0.1              dynamic_miniters = True
  1019                                                   else:
  1020                                                       dynamic_miniters = False
  1021                                           
  1022         2          2.0      1.0      0.1          if mininterval is None:
  1023                                                       mininterval = 0
  1024                                           
  1025         2          1.0      0.5      0.0          if maxinterval is None:
  1026                                                       maxinterval = 0
  1027                                           
  1028         2          1.0      0.5      0.0          if ascii is None:
  1029         2         20.0     10.0      0.8              ascii = not _supports_unicode(file)
  1030                                           
  1031         2          2.0      1.0      0.1          if bar_format and not ((ascii is True) or _is_ascii(ascii)):
  1032                                                       # Convert bar format into unicode since terminal uses unicode
  1033                                                       bar_format = _unicode(bar_format)
  1034                                           
  1035         2          2.0      1.0      0.1          if smoothing is None:
  1036                                                       smoothing = 0
  1037                                           
  1038                                                   # Store the arguments
  1039         2          6.0      3.0      0.2          self.iterable = iterable
  1040         2          2.0      1.0      0.1          self.desc = desc or ''
  1041         2          3.0      1.5      0.1          self.total = total
  1042         2          4.0      2.0      0.2          self.leave = leave
  1043         2          4.0      2.0      0.2          self.fp = file
  1044         2          3.0      1.5      0.1          self.ncols = ncols
  1045         2          2.0      1.0      0.1          self.nrows = nrows
  1046         2          2.0      1.0      0.1          self.mininterval = mininterval
  1047         2          3.0      1.5      0.1          self.maxinterval = maxinterval
  1048         2          2.0      1.0      0.1          self.miniters = miniters
  1049         2          3.0      1.5      0.1          self.dynamic_miniters = dynamic_miniters
  1050         2          2.0      1.0      0.1          self.ascii = ascii
  1051         2          2.0      1.0      0.1          self.disable = disable
  1052         2          3.0      1.5      0.1          self.unit = unit
  1053         2          3.0      1.5      0.1          self.unit_scale = unit_scale
  1054         2          2.0      1.0      0.1          self.unit_divisor = unit_divisor
  1055         2          2.0      1.0      0.1          self.initial = initial
  1056         2          2.0      1.0      0.1          self.lock_args = lock_args
  1057         2          2.0      1.0      0.1          self.gui = gui
  1058         2          2.0      1.0      0.1          self.dynamic_ncols = dynamic_ncols
  1059         2          3.0      1.5      0.1          self.smoothing = smoothing
  1060         2          2.0      1.0      0.1          self.avg_time = None
  1061         2          3.0      1.5      0.1          self.bar_format = bar_format
  1062         2          3.0      1.5      0.1          self.postfix = None
  1063         2          2.0      1.0      0.1          self.colour = colour
  1064         2          4.0      2.0      0.2          self._time = time
  1065         2          2.0      1.0      0.1          if postfix:
  1066                                                       try:
  1067                                                           self.set_postfix(refresh=False, **postfix)
  1068                                                       except TypeError:
  1069                                                           self.postfix = postfix
  1070                                           
  1071                                                   # Init the iterations counters
  1072         2          2.0      1.0      0.1          self.last_print_n = initial
  1073         2          2.0      1.0      0.1          self.n = initial
  1074                                           
  1075                                                   # if nested, at initial sp() call we replace '\r' by '\n' to
  1076                                                   # not overwrite the outer progress bar
  1077         2         13.0      6.5      0.5          with self._lock:
  1078         2          3.0      1.5      0.1              if position is None:
  1079         2         92.0     46.0      3.5                  self.pos = self._get_free_pos(self)
  1080                                                       else:  # mark fixed positions as negative
  1081                                                           self.pos = -position
  1082                                           
  1083         2          2.0      1.0      0.1          if not gui:
  1084                                                       # Initialize the screen printer
  1085         2         15.0      7.5      0.6              self.sp = self.status_printer(self.fp)
  1086         2       2163.0   1081.5     82.1              self.refresh(lock_args=self.lock_args)
  1087                                           
  1088                                                   # Init the time counter
  1089         2          4.0      2.0      0.2          self.last_print_t = self._time()
  1090                                                   # NB: Avoid race conditions by setting start_t at the very end of init
  1091         2          2.0      1.0      0.1          self.start_t = self.last_print_t

Total time: 1e-05 s
File: /home/ryan/github/lltk/venv/lib/python3.7/site-packages/tqdm/std.py
Function: __del__ at line 1121

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
  1121                                               def __del__(self):
  1122         1         10.0     10.0    100.0          self.close()

Total time: 0.000526 s
File: /home/ryan/github/lltk/venv/lib/python3.7/site-packages/tqdm/std.py
Function: __repr__ at line 1124

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
  1124                                               def __repr__(self):
  1125         5        526.0    105.2    100.0          return self.format_meter(**self.format_dict)

Total time: 4e-06 s
File: /home/ryan/github/lltk/venv/lib/python3.7/site-packages/tqdm/std.py
Function: __hash__ at line 1131

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
  1131                                               def __hash__(self):
  1132         4          4.0      1.0    100.0          return id(self)

Total time: 0.002992 s
File: /home/ryan/github/lltk/venv/lib/python3.7/site-packages/tqdm/std.py
Function: __iter__ at line 1134

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
  1134                                               def __iter__(self):
  1135                                                   """Backward-compatibility to use: for x in tqdm(iterable)"""
  1136                                           
  1137                                                   # Inlining instance variables as locals (speed optimisation)
  1138         2          2.0      1.0      0.1          iterable = self.iterable
  1139                                           
  1140                                                   # If the bar is disabled, then just walk the iterable
  1141                                                   # (note: keep this check outside the loop for performance)
  1142         2          2.0      1.0      0.1          if self.disable:
  1143                                                       for obj in iterable:
  1144                                                           yield obj
  1145                                                       return
  1146                                           
  1147         2          0.0      0.0      0.0          mininterval = self.mininterval
  1148         2          2.0      1.0      0.1          maxinterval = self.maxinterval
  1149         2          2.0      1.0      0.1          miniters = self.miniters
  1150         2          3.0      1.5      0.1          dynamic_miniters = self.dynamic_miniters
  1151         2          1.0      0.5      0.0          last_print_t = self.last_print_t
  1152         2          1.0      0.5      0.0          last_print_n = self.last_print_n
  1153         2          2.0      1.0      0.1          n = self.n
  1154         2          2.0      1.0      0.1          smoothing = self.smoothing
  1155         2          2.0      1.0      0.1          avg_time = self.avg_time
  1156         2          1.0      0.5      0.0          time = self._time
  1157                                           
  1158         2          1.0      0.5      0.0          if not hasattr(self, 'sp'):
  1159                                                       raise TqdmDeprecationWarning(
  1160                                                           "Please use `tqdm.gui.tqdm(...)` instead of"
  1161                                                           " `tqdm(..., gui=True)`\n",
  1162                                                           fp_write=getattr(self.fp, 'write', sys.stderr.write))
  1163                                           
  1164         2          0.0      0.0      0.0          try:
  1165         5          3.0      0.6      0.1              for obj in iterable:
  1166         4          1.0      0.2      0.0                  yield obj
  1167                                                           # Update and possibly print the progressbar.
  1168                                                           # Note: does not call self.update(1) for speed optimisation.
  1169         3          3.0      1.0      0.1                  n += 1
  1170                                                           # check counter first to avoid calls to time()
  1171         3          3.0      1.0      0.1                  if n - last_print_n >= self.miniters:
  1172         3          2.0      0.7      0.1                      miniters = self.miniters  # watch monitoring thread changes
  1173         3          4.0      1.3      0.1                      delta_t = time() - last_print_t
  1174         3          2.0      0.7      0.1                      if delta_t >= mininterval:
  1175         1          1.0      1.0      0.0                          cur_t = time()
  1176         1          0.0      0.0      0.0                          delta_it = n - last_print_n
  1177                                                                   # EMA (not just overall average)
  1178         1          1.0      1.0      0.0                          if smoothing and delta_t and delta_it:
  1179         1          2.0      2.0      0.1                              rate = delta_t / delta_it
  1180         1          2.0      2.0      0.1                              avg_time = self.ema(rate, avg_time, smoothing)
  1181         1          1.0      1.0      0.0                              self.avg_time = avg_time
  1182                                           
  1183         1          0.0      0.0      0.0                          self.n = n
  1184         1        557.0    557.0     18.6                          self.refresh(lock_args=self.lock_args)
  1185                                           
  1186                                                                   # If no `miniters` was specified, adjust automatically
  1187                                                                   # to the max iteration rate seen so far between 2 prints
  1188         1          0.0      0.0      0.0                          if dynamic_miniters:
  1189         1          0.0      0.0      0.0                              if maxinterval and delta_t >= maxinterval:
  1190                                                                           # Adjust miniters to time interval by rule of 3
  1191                                                                           if mininterval:
  1192                                                                               # Set miniters to correspond to mininterval
  1193                                                                               miniters = delta_it * mininterval / delta_t
  1194                                                                           else:
  1195                                                                               # Set miniters to correspond to maxinterval
  1196                                                                               miniters = delta_it * maxinterval / delta_t
  1197         1          1.0      1.0      0.0                              elif smoothing:
  1198                                                                           # EMA-weight miniters to converge
  1199                                                                           # towards the timeframe of mininterval
  1200         1          1.0      1.0      0.0                                  rate = delta_it
  1201         1          1.0      1.0      0.0                                  if mininterval and delta_t:
  1202         1          1.0      1.0      0.0                                      rate *= mininterval / delta_t
  1203         1          2.0      2.0      0.1                                  miniters = self.ema(rate, miniters, smoothing)
  1204                                                                       else:
  1205                                                                           # Maximum nb of iterations between 2 prints
  1206                                                                           miniters = max(miniters, delta_it)
  1207                                           
  1208                                                                   # Store old values for next call
  1209         1          1.0      1.0      0.0                          self.n = self.last_print_n = last_print_n = n
  1210         1          0.0      0.0      0.0                          self.last_print_t = last_print_t = cur_t
  1211         1          0.0      0.0      0.0                          self.miniters = miniters
  1212                                                   finally:
  1213                                                       # Closing the progress bar.
  1214                                                       # Update some internal variables for close().
  1215         2          2.0      1.0      0.1              self.last_print_n = last_print_n
  1216         2          0.0      0.0      0.0              self.n = n
  1217         2          2.0      1.0      0.1              self.miniters = miniters
  1218         2       2378.0   1189.0     79.5              self.close()

Total time: 0.002354 s
File: /home/ryan/github/lltk/venv/lib/python3.7/site-packages/tqdm/std.py
Function: close at line 1302

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
  1302                                               def close(self):
  1303                                                   """Cleanup and (if leave=False) close the progressbar."""
  1304         3          4.0      1.3      0.2          if self.disable:
  1305         1          1.0      1.0      0.0              return
  1306                                           
  1307                                                   # Prevent multiple closures
  1308         2          1.0      0.5      0.0          self.disable = True
  1309                                           
  1310                                                   # decrement instance pos and remove from internal set
  1311         2          2.0      1.0      0.1          pos = abs(self.pos)
  1312         2         74.0     37.0      3.1          self._decr_instances(self)
  1313                                           
  1314                                                   # GUI mode
  1315         2          2.0      1.0      0.1          if not hasattr(self, "sp"):
  1316                                                       return
  1317                                           
  1318                                                   # annoyingly, _supports_unicode isn't good enough
  1319         2          1.0      0.5      0.0          def fp_write(s):
  1320                                                       self.fp.write(_unicode(s))
  1321                                           
  1322         2          1.0      0.5      0.0          try:
  1323         2        230.0    115.0      9.8              fp_write('')
  1324                                                   except ValueError as e:
  1325                                                       if 'closed' in str(e):
  1326                                                           return
  1327                                                       raise  # pragma: no cover
  1328                                           
  1329         2          2.0      1.0      0.1          leave = pos == 0 if self.leave is None else self.leave
  1330                                           
  1331         2          8.0      4.0      0.3          with self._lock:
  1332         2          2.0      1.0      0.1              if leave:
  1333                                                           # stats for overall rate (no weighted average)
  1334         2          2.0      1.0      0.1                  self.avg_time = None
  1335         2       1925.0    962.5     81.8                  self.display(pos=0)
  1336         2         99.0     49.5      4.2                  fp_write('\n')
  1337                                                       else:
  1338                                                           # clear previous display
  1339                                                           if self.display(msg='', pos=pos) and not pos:
  1340                                                               fp_write('\r')

Total time: 0.002688 s
File: /home/ryan/github/lltk/venv/lib/python3.7/site-packages/tqdm/std.py
Function: refresh at line 1358

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
  1358                                               def refresh(self, nolock=False, lock_args=None):
  1359                                                   """
  1360                                                   Force refresh the display of this bar.
  1361                                           
  1362                                                   Parameters
  1363                                                   ----------
  1364                                                   nolock  : bool, optional
  1365                                                       If `True`, does not lock.
  1366                                                       If [default: `False`]: calls `acquire()` on internal lock.
  1367                                                   lock_args  : tuple, optional
  1368                                                       Passed to internal lock's `acquire()`.
  1369                                                       If specified, will only `display()` if `acquire()` returns `True`.
  1370                                                   """
  1371         3          2.0      0.7      0.1          if self.disable:
  1372                                                       return
  1373                                           
  1374         3          1.0      0.3      0.0          if not nolock:
  1375         3          1.0      0.3      0.0              if lock_args:
  1376                                                           if not self._lock.acquire(*lock_args):
  1377                                                               return False
  1378                                                       else:
  1379         3         10.0      3.3      0.4                  self._lock.acquire()
  1380         3       2654.0    884.7     98.7          self.display()
  1381         3          0.0      0.0      0.0          if not nolock:
  1382         3         18.0      6.0      0.7              self._lock.release()
  1383         3          2.0      0.7      0.1          return True

Total time: 0.004536 s
File: /home/ryan/github/lltk/venv/lib/python3.7/site-packages/tqdm/std.py
Function: display at line 1489

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
  1489                                               def display(self, msg=None, pos=None):
  1490                                                   """
  1491                                                   Use `self.sp` to display `msg` in the specified `pos`.
  1492                                           
  1493                                                   Consider overloading this function when inheriting to use e.g.:
  1494                                                   `self.some_frontend(**self.format_dict)` instead of `self.sp`.
  1495                                           
  1496                                                   Parameters
  1497                                                   ----------
  1498                                                   msg  : str, optional. What to display (default: `repr(self)`).
  1499                                                   pos  : int, optional. Position to `moveto`
  1500                                                     (default: `abs(self.pos)`).
  1501                                                   """
  1502         5          2.0      0.4      0.0          if pos is None:
  1503         3          1.0      0.3      0.0              pos = abs(self.pos)
  1504                                           
  1505         5          0.0      0.0      0.0          nrows = self.nrows or 20
  1506         5          3.0      0.6      0.1          if pos >= nrows - 1:
  1507                                                       if pos >= nrows:
  1508                                                           return False
  1509                                                       if msg or msg is None:  # override at `nrows - 1`
  1510                                                           msg = " ... (more hidden) ..."
  1511                                           
  1512         5          3.0      0.6      0.1          if pos:
  1513                                                       self.moveto(pos)
  1514         5       4519.0    903.8     99.6          self.sp(self.__repr__() if msg is None else msg)
  1515         5          7.0      1.4      0.2          if pos:
  1516                                                       self.moveto(-pos)
  1517         5          1.0      0.2      0.0          return True

Total time: 3.89032 s
File: <ipython-input-5-0cf5c0c718f2>
Function: go at line 1

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================